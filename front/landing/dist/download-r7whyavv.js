import"./client-g4s4q7ha.js";var q=Uint8Array,U=Uint16Array,BH=Int32Array,QH=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),RH=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MH=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),VH=function(H,J){var K=new U(31);for(var Q=0;Q<31;++Q)K[Q]=J+=1<<H[Q-1];var R=new BH(K[30]);for(var Q=1;Q<30;++Q)for(var B=K[Q];B<K[Q+1];++B)R[B]=B-K[Q]<<5|Q;return{b:K,r:R}},WH=VH(QH,2),XH=WH.b,LH=WH.r;XH[28]=258,LH[258]=28;var YH=VH(RH,0),PH=YH.b,xH=YH.r,b=new U(32768);for(V=0;V<32768;++V)L=(V&43690)>>1|(V&21845)<<1,L=(L&52428)>>2|(L&13107)<<2,L=(L&61680)>>4|(L&3855)<<4,b[V]=((L&65280)>>8|(L&255)<<8)>>1;var L,V,x=function(H,J,K){var Q=H.length,R=0,B=new U(J);for(;R<Q;++R)if(H[R])++B[H[R]-1];var O=new U(J);for(R=1;R<J;++R)O[R]=O[R-1]+B[R-1]<<1;var $;if(K){$=new U(1<<J);var X=15-J;for(R=0;R<Q;++R)if(H[R]){var C=R<<4|H[R],Y=J-H[R],N=O[H[R]-1]++<<Y;for(var W=N|(1<<Y)-1;N<=W;++N)$[b[N]>>X]=C}}else{$=new U(Q);for(R=0;R<Q;++R)if(H[R])$[R]=b[O[H[R]-1]++]>>15-H[R]}return $},S=new q(288);for(V=0;V<144;++V)S[V]=8;var V;for(V=144;V<256;++V)S[V]=9;var V;for(V=256;V<280;++V)S[V]=7;var V;for(V=280;V<288;++V)S[V]=8;var V,$H=new q(32);for(V=0;V<32;++V)$H[V]=5;var V;var jH=x(S,9,1);var GH=x($H,5,1),n=function(H){var J=H[0];for(var K=1;K<H.length;++K)if(H[K]>J)J=H[K];return J},F=function(H,J,K){var Q=J/8|0;return(H[Q]|H[Q+1]<<8)>>(J&7)&K},o=function(H,J){var K=J/8|0;return(H[K]|H[K+1]<<8|H[K+2]<<16)>>(J&7)},TH=function(H){return(H+7)/8|0},ZH=function(H,J,K){if(J==null||J<0)J=0;if(K==null||K>H.length)K=H.length;return new q(H.subarray(J,K))};var UH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],j=function(H,J,K){var Q=Error(J||UH[H]);if(Q.code=H,Error.captureStackTrace)Error.captureStackTrace(Q,j);if(!K)throw Q;return Q},AH=function(H,J,K,Q){var R=H.length,B=Q?Q.length:0;if(!R||J.f&&!J.l)return K||new q(0);var O=!K,$=O||J.i!=2,X=J.i;if(O)K=new q(R*3);var C=function(JH){var KH=K.length;if(JH>KH){var NH=new q(Math.max(KH*2,JH));NH.set(K),K=NH}},Y=J.f||0,N=J.p||0,W=J.b||0,P=J.l,w=J.d,A=J.m,I=J.n,y=R*8;do{if(!P){Y=F(H,N,1);var k=F(H,N+1,3);if(N+=3,!k){var M=TH(N)+4,v=H[M-4]|H[M-3]<<8,h=M+v;if(h>R){if(X)j(0);break}if($)C(W+v);K.set(H.subarray(M,h),W),J.b=W+=v,J.p=N=h*8,J.f=Y;continue}else if(k==1)P=jH,w=GH,A=9,I=5;else if(k==2){var _=F(H,N,31)+257,c=F(H,N+10,15)+4,a=_+F(H,N+5,31)+1;N+=14;var D=new q(a),m=new q(19);for(var E=0;E<c;++E)m[MH[E]]=F(H,N+E*3,7);N+=c*3;var l=n(m),CH=(1<<l)-1,EH=x(m,l,1);for(var E=0;E<a;){var d=EH[F(H,N,CH)];N+=d&15;var M=d>>4;if(M<16)D[E++]=M;else{var T=0,z=0;if(M==16)z=3+F(H,N,3),N+=2,T=D[E-1];else if(M==17)z=3+F(H,N,7),N+=3;else if(M==18)z=11+F(H,N,127),N+=7;while(z--)D[E++]=T}}var i=D.subarray(0,_),G=D.subarray(_);A=n(i),I=n(G),P=x(i,A,1),w=x(G,I,1)}else j(1);if(N>y){if(X)j(0);break}}if($)C(W+131072);var qH=(1<<A)-1,OH=(1<<I)-1,u=N;for(;;u=N){var T=P[o(H,N)&qH],Z=T>>4;if(N+=T&15,N>y){if(X)j(0);break}if(!T)j(2);if(Z<256)K[W++]=Z;else if(Z==256){u=N,P=null;break}else{var s=Z-254;if(Z>264){var E=Z-257,g=QH[E];s=F(H,N,(1<<g)-1)+XH[E],N+=g}var r=w[o(H,N)&OH],p=r>>4;if(!r)j(3);N+=r&15;var G=PH[p];if(p>3){var g=RH[p];G+=o(H,N)&(1<<g)-1,N+=g}if(N>y){if(X)j(0);break}if($)C(W+131072);var t=W+s;if(W<G){var HH=B-G,FH=Math.min(G,t);if(HH+W<0)j(3);for(;W<FH;++W)K[W]=Q[HH+W]}for(;W<t;++W)K[W]=K[W-G]}}if(J.l=P,J.p=u,J.b=W,J.f=Y,P)Y=1,J.m=A,J.d=w,J.n=I}while(!Y);return W!=K.length&&O?ZH(K,0,W):K.subarray(0,W)};var IH=new q(0);function f(H,J){return AH(H,{i:2},J&&J.out,J&&J.dictionary)}var DH=typeof TextDecoder<"u"&&new TextDecoder,gH=0;try{DH.decode(IH,{stream:!0}),gH=1}catch(H){}var e=(H)=>{if(H instanceof Uint8Array)return H;if(H instanceof ArrayBuffer)return new Uint8Array(H);if(ArrayBuffer.isView(H))return new Uint8Array(H.buffer);if(typeof H==="string"){let J=atob(H),K=new Uint8Array(J.length);for(let Q=0;Q<J.length;Q++)K[Q]=J.charCodeAt(Q);return K}if(typeof H==="object"&&H!==null){let J=H;if(J.__type==="Uint8Array"&&"data"in J)return e(J.data)}throw Error("StoreService.get returned invalid data")};async function zH(H,J,K){console.log("[downloadFile] Starting download for:",H);let Q=await J.get(H);console.log("[downloadFile] Metadata loaded:",Q);let R=await J.getChunks(H);if(console.log("[downloadFile] Chunks loaded:",R.length),R.sort((X,C)=>X.chunkNumber-C.chunkNumber),"showSaveFilePicker"in window)try{let C=await(await window.showSaveFilePicker({suggestedName:Q.name,types:Q.fileType?[{description:"File",accept:{[Q.fileType]:[]}}]:void 0})).createWritable();for(let Y of R){console.log("[downloadFile] Processing chunk:",Y.chunkNumber);let N=await K.get(Y.hash),W=e(N),P=f(W);await C.write(P)}return await C.close(),console.log("[downloadFile] File written successfully via File System Access API"),{blob:new Blob([]),fileName:Q.name}}catch(X){if(X?.name==="AbortError")throw Error("User cancelled download");console.warn("[downloadFile] File System Access API failed, falling back to blob:",X)}console.log("[downloadFile] Using blob fallback");let O=[];for(let X of R){let C=await K.get(X.hash),Y=e(C),N=f(Y);O.push(N)}let $=new Blob(O,{type:Q.fileType});return console.log("[downloadFile] Blob created:",$.size,"bytes"),{blob:$,fileName:Q.name}}export{zH as downloadFile};
