{
	"nodes": {
		"start": {
			"type": "StartNode",
			"params": {
				"consts": {
					"mail_id": null
				}
			}
		},
		"get_draft": {
			"type": "SQLQueryNode",
			"params": {
				"query": "SELECT * FROM mail_draft WHERE id = :$.context.start.mail_id",
				"provider": "salesProvider"
			}
		},
		"insert_mail": {
			"type": "SQLQueryNode",
			"params": {
				"query": "INSERT INTO outgoing ( \"from\", \"to\", subject, body,type,start_send_date,spy ) VALUES (:$.context.get_draft[0].sender, :$.context.get_draft[0].recipient, :$.context.get_draft[0].subject, :$.context.get_draft[0].body,'html',now(),:$.context.get_draft[0].spy) RETURNING id;",
				"provider": "emailsProvider"
			}
		},
		"set_mail_id": {
			"type": "SQLQueryNode",
			"params": {
				"query": "UPDATE mail_draft SET mail_id = :$.context.insert_mail[0].id WHERE id = :$.context.get_draft[0].id",
				"provider": "salesProvider"
			}
		},
		"print": {
			"type": "PrintNode"
		}
	},
	"connections": {
		"start": ["get_draft"],
		"get_draft": ["insert_mail"],
		"insert_mail": ["set_mail_id", "print"]
	}
}
