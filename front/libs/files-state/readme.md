# File Transfer Library

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∂–∞—Ç–∏—è, –±–ª–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üóúÔ∏è **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è Deflate** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π
- üì¶ **–ë–ª–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –±–ª–æ–∫–∏ –ø–æ 1MB –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- üîÑ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SHA-256 –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤
- ‚è∏Ô∏è **Pause/Resume** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- üîÅ **Retry –º–µ—Ö–∞–Ω–∏–∑–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è —É–ø–∞–≤—à–∏—Ö —á–∞–Ω–∫–æ–≤
- ‚ö° **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞–Ω–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- üß© **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏ —Å —è–≤–Ω—ã–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏
- üîß **Singleton —Å–µ—Ä–≤–∏—Å—ã** - –ø—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ state

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **Singleton –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤** - —Å–µ—Ä–≤–∏—Å—ã –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
2. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
3. **–°–ª–∞–±–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —Ñ–∞–π–ª `integrations.ts`

 

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
import { services } from './src';
import { createFilesService } from './api/files';
import { createStoreService } from './api/store';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
services.setFilesService(createFilesService());
services.setStoreService(createStoreService());
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Upload —Ñ–∞–π–ª–∞

```typescript
import { openFilePicker, $files, getFileProgress } from './src';

// –û—Ç–∫—Ä—ã—Ç—å file picker
openFilePicker();

// –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
$files.watch(files => {
  files.forEach(file => {
    console.log(`${file.fileName}: ${file.status}`);
  });
});

// –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
const progress$ = getFileProgress(fileId);
progress$.watch(p => console.log(`${p?.progress}%`));
```

### Download —Ñ–∞–π–ª–∞

```typescript
import { downloadRequested } from './model';

downloadRequested('file-uuid');
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–æ–π

```typescript
import { pauseUpload, resumeUpload, cancelUpload, retryChunk } from './model';

// –ü–∞—É–∑–∞
pauseUpload(fileId);

// –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
resumeUpload(fileId);

// –û—Ç–º–µ–Ω–∞
cancelUpload(fileId);

// –ü–æ–≤—Ç–æ—Ä —É–ø–∞–≤—à–µ–≥–æ —á–∞–Ω–∫–∞
retryChunk({ fileId, chunkNumber });
```

## React –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
import { useUnit } from 'effector-react';
import { $files, getFileProgress, pauseUpload, resumeUpload } from './model';

function FileUploadList() {
  const files = useUnit($files);
  
  return (
    <div>
      {Array.from(files.values()).map(file => (
        <FileItem key={file.fileId} fileId={file.fileId} />
      ))}
    </div>
  );
}

function FileItem({ fileId }) {
  const progress = useUnit(getFileProgress(fileId));
  
  if (!progress) return null;
  
  return (
    <div>
      <span>{progress.progress}%</span>
      <button onClick={() => pauseUpload(fileId)}>Pause</button>
      <button onClick={() => resumeUpload(fileId)}>Resume</button>
    </div>
  );
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
// config.ts
export const BLOCK_SIZE = 1024 * 1024;        // 1MB –±–ª–æ–∫–∏
export const COMPRESSION_LEVEL = 6;           // 0-9, –≥–¥–µ 9 –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ
export const MAX_PARALLEL_UPLOADS = 3;        // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏
export const MAX_RETRY_ATTEMPTS = 3;          // –ü–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞
export const UPLOAD_TIMEOUT = 30000;          // –¢–∞–π–º–∞—É—Ç –≤ –º—Å
```

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### Upload Flow
```
File selected ‚Üí Compression ‚Üí Chunking ‚Üí Block save ‚Üí Metadata save ‚Üí Complete
```

### Download Flow  
```
Request ‚Üí Load metadata ‚Üí Load chunks ‚Üí Decompression ‚Üí Write to file ‚Üí Complete
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm test
```

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π.

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ARCHITECTURE.md](./ARCHITECTURE.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [USAGE.md](./USAGE.md) - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [MIGRATION.md](./MIGRATION.md) - –ì–∞–π–¥ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [SUMMARY.md](./SUMMARY.md) - –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT