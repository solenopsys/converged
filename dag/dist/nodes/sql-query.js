import{JSONPath as u}from"jsonpath-plus";function l(s){let n=/:(\$\{[^}]+\}|[^\s,;)]+)/g,o=[],e;while((e=n.exec(s))!==null){let r=e[1],i;if(r.startsWith("${")&&r.endsWith("}"))i=r.slice(2,-1);else if(r.startsWith("$."))i=r;else i=`$.${r}`;o.push(i)}return o}class b{name;query;provider;providers;scope;constructor(s,n,o,e){this.name=s;this.query=n;this.provider=o;this.providers=e}async execute(s,n){let o=this.query,e=l(o),r=[];for(let v=0;v<e.length;v++){let c=e[v],t=await n.getFrom(s,c);r.push(t);let y=`:${c}`;o=o.replaceAll(y,`$${v+1}`)}return console.log("Transformed SQL:",o),console.log("Parameter values:",r),await this.providers[this.provider].query(o,r)}}export{b as SQLQueryNode};
