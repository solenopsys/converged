# üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è DAG –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **immutable key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö (LMDB)** –∏ **–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π SQLite-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**.  
–¶–µ–ª—å: 100% –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, –≤—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üóÉÔ∏è –•—Ä–∞–Ω–∏–ª–∏—â–∞

| –§–∞–π–ª               | –¢–∏–ø    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                          |
|--------------------|--------|-----------------------------------------------------|
| `dag.lmdb`         | LMDB   | –•—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è DAG, —É–∑–ª–æ–≤, –≤–µ—Ä—Å–∏–π –∫–æ–¥–∞          |
| `processes.lmdb`   | LMDB   | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è        |
| `index.sqlite`     | SQLite | –ë—ã—Å—Ç—Ä—ã–π –∏–Ω–¥–µ–∫—Å (–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π), –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–π     |

---

## üìÅ `dag.lmdb` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤

### `code:{hash}` ‚Üí `string`
–•—Ä–∞–Ω–∏—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —É–∑–ª–∞ (JS, Python –∏ —Ç.–¥.).  
–ö–ª—é—á —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Ö–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ, –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –∫–æ–¥.

### `node_code:{name}:{version}` ‚Üí `{ code_hash, params }`
–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —É–∑–ª–∞.  
–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∫–æ–¥ –∏ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ –∏–º–µ–Ω–∏ –∏ –≤–µ—Ä—Å–∏–∏.

### `node:{hash}` ‚Üí `{ config, codeName, codeVersion }`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞ DAG.  
–ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞ (hash –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤).

### `workflow_config`:{hash}` ‚Üí `{ nodes: [...], links: [...], description }`
–û–ø–∏—Å–∞–Ω–∏–µ DAG-–≥—Ä–∞—Ñ–∞, –≤–∫–ª—é—á–∞—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.  
–ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –ø–æ `workflow_id`.

### `workflow:{name}:{version}` ‚Üí `{ workflow_version_hash }`
–û–ø–∏—Å–∞–Ω–∏–µ DAG-–≥—Ä–∞—Ñ–∞, –≤–∫–ª—é—á–∞—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.  
–ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –ø–æ `workflow_id`.

### `webhook:{name}:{version}` ‚Üí `{ url, method, workflow_id, options }`
Webhook-–∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏, –≤—ã–∑—ã–≤–∞—é—â–∏–µ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

---

## üìÅ `processes.lmdb` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### `process:{id}` ‚Üí `{ created_at, workflow_id (optional), meta }`
–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.  
–ú–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –≤—Ä—É—á–Ω—É—é, webhook-–æ–º –∏–ª–∏ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å.

### `event:{process_id}:{ulid}` ‚Üí `{ type, node_id, payload, ts, executor_id (optional) }`
–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –æ—Ç—Ä–∞–∂–∞—é—â–µ–µ —Ñ–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è/–æ—à–∏–±–∫–∏/—Å—Ç–∞—Ç—É—Å–∞.  
–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:
- `process_started`
- `node_started`
- `node_result`
- `node_error`
- `custom_event`

---

## üóÇÔ∏è `index.sqlite` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º—ã–π –∏–Ω–¥–µ–∫—Å

SQLite —Ö—Ä–∞–Ω–∏—Ç **–±—ã—Å—Ç—Ä–æ–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å.  
–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ LMDB (—á–µ—Ä–µ–∑ `rebuild_index()`).

### –¢–∞–±–ª–∏—Ü–∞ `process`

| –ü–æ–ª–µ         | –û–ø–∏—Å–∞–Ω–∏–µ                               |
|--------------|----------------------------------------|
| `id`         | ID –ø—Ä–æ—Ü–µ—Å—Å–∞                            |
| `workflow_id`| –ü—Ä–∏–≤—è–∑–∫–∞ –∫ workflow                    |
| `status`     | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (`running`, `done`, ...)|
| `started_at` | –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞                          |
| `updated_at` | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ                   |

### –¢–∞–±–ª–∏—Ü–∞ `nodes`

| –ü–æ–ª–µ          | –û–ø–∏—Å–∞–Ω–∏–µ                                |
|---------------|-----------------------------------------|
| `node_id`     | ID —É–∑–ª–∞                                 |
| `state`       | `queued`, `running`, `done`, `failed`  |

### –¢–∞–±–ª–∏—Ü–∞ `workflow`

| –ü–æ–ª–µ       | –û–ø–∏—Å–∞–Ω–∏–µ              |
|------------|-----------------------|
| `id`       | ID workflow           |
| `name`     | –ù–∞–∑–≤–∞–Ω–∏–µ              |
| `created_at`| –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è        |
| current_version | –≤–µ—Ä—Å–∏—è workflow |


### –¢–∞–±–ª–∏—Ü–∞ `webhook`

| –ü–æ–ª–µ        | –û–ø–∏—Å–∞–Ω–∏–µ              |
|-------------|-----------------------|
| `id`        | ID webhook            |
| `workflow_id`| Workflow –ø–æ –≤—ã–∑–æ–≤—É   |
| `url`       | –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞        |
| `method`    | HTTP-–º–µ—Ç–æ–¥ (GET/POST) |

---

## üí° –ü—Ä–∏–Ω—Ü–∏–ø—ã

- –í—Å–µ —Å–æ–±—ã—Ç–∏—è **immutable**, —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –≤ LMDB.
- SQLite –∏–Ω–¥–µ–∫—Å ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–π, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ:  
  `event` ‚Üí `executor (stateless)` ‚Üí `new event`.

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- üíæ **100% –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å** ‚Äî LMDB —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é.
- ‚öôÔ∏è **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è.
- üß† **–û—Ç–ª–∞–¥–∫–∞ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** ‚Äî –ø–æ —Å–æ–±—ã—Ç–∏—è–º –≤–∏–¥–Ω–∞ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è.
- üîÑ **Replay / Retry** ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π.

---

## üõ†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

- –£—Ç–∏–ª–∏—Ç–∞ `rebuild_index.go` (–∏–ª–∏ Rust) ‚Äî –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ SQLite –ø–æ LMDB.
- CLI –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞ workflow.
- Live-–ª–æ–≥ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ `tail -f` LMDB.
