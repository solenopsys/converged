# nRPC

Нативный RPC для TypeScript, аналог tRPC, использующий интерфейсы TypeScript для автоматической генерации кода.

## Основная идея

nRPC позволяет вызывать методы сервера напрямую с клиента без необходимости вручную создавать и синхронизировать REST API. Это достигается за счет кодогенерации на основе TypeScript-интерфейсов, что исключает дублирование кода и уменьшает количество ошибок.

## Как это работает

Система состоит из нескольких ключевых компонентов, которые вместе обеспечивают бесшовную интеграцию между клиентом и сервером.

### 1. Парсер интерфейсов (`interface-parser.ts`)

- **Задача:** Анализ TypeScript-файлов с интерфейсами сервисов.
- **Процесс:**
    - Использует `@typescript-eslint/typescript-estree` для построения AST (абстрактного синтаксического дерева).
    - Извлекает метаданные:
        - Интерфейсы и их методы.
        - Параметры методов и их типы.
        - Типы возвращаемых значений.
        - Пользовательские типы (`type`, `interface`).
    - Сохраняет все в структуру `ServiceMetadata`.

### 2. Генератор маршрутов (`route-utils.ts`)

- **Задача:** Создание URL-путей для серверных методов.
- **Процесс:**
    - Преобразует имена методов из `camelCase` в `snake_case`.
    - Генерирует уникальный путь для каждого метода на основе имени сервиса и метода (например, `/userService/get_user_by_id`).

### 3. Генератор бэкенда (`backend-generator.ts`)

- **Задача:** Создание конфигурационного файла для сервера.
- **Процесс:**
    - Генерирует импорты для всех реализаций сервисов.
    - Создает конфигурацию, которая связывает маршруты с конкретными методами сервисов.
    - Эта конфигурация используется для инициализации сервера и обработки входящих запросов.

### 4. Генератор фронтенда (`frontend-generator.ts`)

- **Задача:** Создание HTTP-клиента для клиентского приложения.
- **Процесс:**
    - Генерирует TypeScript-определения для всех пользовательских типов.
    - Создает классы-клиенты для каждого сервиса, методы которых полностью соответствуют серверным.
    - Предоставляет единый `ApiClient` для доступа ко всем сервисам.

### 5. HTTP-клиент (`http-client.ts`)

- **Задача:** Выполнение HTTP-запросов к серверу.
- **Процесс:**
    - Является runtime-библиотекой для сгенерированного клиента.
    - Использует `fetch` для отправки запросов.
    - Находит нужный маршрут, формирует URL с параметрами и выполняет вызов.

## Преимущества

- **Автоматизация:** Избавляет от ручного написания и синхронизации API.
- **Типобезопасность:** Сохраняет строгую типизацию между клиентом и сервером.
- **Меньше ошибок:** Снижает вероятность ошибок, связанных с несоответствием API.
- **Прозрачность:** Вызовы серверных методов выглядят как обычные асинхронные функции на клиенте.
