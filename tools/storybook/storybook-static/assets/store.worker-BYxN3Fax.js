var RH=Object.defineProperty;var yO=(O,H)=>{for(var C in H)RH(O,C,{get:H[C],enumerable:!0,configurable:!0,set:(K)=>H[C]=()=>K})};var UO=(O,H)=>()=>(O&&(H=O(O=0)),H);var oO={};yO(oO,{createStoreService:()=>WH});function WH(){return{save:async(O,H,C)=>{let K=await crypto.subtle.digest("SHA-256",O),R=Array.from(new Uint8Array(K)).map((Y)=>Y.toString(16).padStart(2,"0")).join("");return QO.set(R,O),R},get:async(O)=>{if(QO.has(O))return QO.get(O);throw Error("Not Found")},delete:async(O)=>{QO.delete(O)}}}var QO;var fO=UO(()=>{QO=new Map});var cO=()=>{};var lO=30000;var dO=UO(()=>{cO()});var iO={};yO(iO,{createStoreService:()=>LH});async function TO(O,H){if(!H||H<=0)return O;let C,K=new Promise((E,R)=>{C=setTimeout(()=>{R(Error(`StoreService request timed out after ${H}ms`))},H)});try{return await Promise.race([O,K])}finally{clearTimeout(C)}}function LH(O={}){let{baseUrl:H=qH,fetchImpl:C=fetch,requestTimeoutMs:K=lO}=O,E=H.replace(/\/+$/,"");async function R(Q,$,N){let V=BH(Q),J=await TO(C(`${E}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:V,originalSize:$??Q.length,compression:N??"none"})}),K);if(!J.ok){let W=await gO(J);throw Error(`StoreService.save failed: ${J.status} ${J.statusText}${W?` - ${W}`:""}`)}let F=await J.json();return typeof F==="string"?F:F.result}async function Y(Q){let $=await TO(C(`${E}/get`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:Q})}),K);if(!$.ok){let V=await gO($);throw Error(`StoreService.get failed: ${$.status} ${$.statusText}${V?` - ${V}`:""}`)}let N=await $.json();return IH(N.result)}async function X(Q){let $=await TO(C(`${E}/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:Q})}),K);if(!$.ok){let N=await gO($);throw Error(`StoreService.delete failed: ${$.status} ${$.statusText}${N?` - ${N}`:""}`)}}return{save:R,get:Y,delete:X}}async function gO(O){try{return await O.text()}catch{return""}}function BH(O){let H="";for(let C=0;C<O.byteLength;C++)H+=String.fromCharCode(O[C]);return btoa(H)}function IH(O){let H=atob(O),C=new Uint8Array(H.length);for(let K=0;K<H.length;K++)C[K]=H.charCodeAt(K);return C}var qH="/services/store";var aO=UO(()=>{dO()});var T=Uint8Array,p=Uint16Array,ZO=Int32Array,$O=new T([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),PO=new T([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),IO=new T([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kO=function(O,H){var C=new p(31);for(var K=0;K<31;++K)C[K]=H+=1<<O[K-1];var E=new ZO(C[30]);for(var K=1;K<30;++K)for(var R=C[K];R<C[K+1];++R)E[R]=R-C[K]<<5|K;return{b:C,r:E}},_O=kO($O,2),hO=_O.b,AO=_O.r;hO[28]=258,AO[258]=28;var uO=kO(PO,0),EH=uO.b,wO=uO.r,GO=new p(32768);for(P=0;P<32768;++P)f=(P&43690)>>1|(P&21845)<<1,f=(f&52428)>>2|(f&13107)<<2,f=(f&61680)>>4|(f&3855)<<4,GO[P]=((f&65280)>>8|(f&255)<<8)>>1;var f,P,c=function(O,H,C){var K=O.length,E=0,R=new p(H);for(;E<K;++E)if(O[E])++R[O[E]-1];var Y=new p(H);for(E=1;E<H;++E)Y[E]=Y[E-1]+R[E-1]<<1;var X;if(C){X=new p(1<<H);var Q=15-H;for(E=0;E<K;++E)if(O[E]){var $=E<<4|O[E],N=H-O[E],V=Y[O[E]-1]++<<N;for(var J=V|(1<<N)-1;V<=J;++V)X[GO[V]>>Q]=$}}else{X=new p(K);for(E=0;E<K;++E)if(O[E])X[E]=GO[Y[O[E]-1]++]>>15-O[E]}return X},e=new T(288);for(P=0;P<144;++P)e[P]=8;var P;for(P=144;P<256;++P)e[P]=9;var P;for(P=256;P<280;++P)e[P]=7;var P;for(P=280;P<288;++P)e[P]=8;var P,YO=new T(32);for(P=0;P<32;++P)YO[P]=5;var P,NH=c(e,9,0),YH=c(e,9,1),VH=c(YO,5,0),XH=c(YO,5,1),qO=function(O){var H=O[0];for(var C=1;C<O.length;++C)if(O[C]>H)H=O[C];return H},b=function(O,H,C){var K=H/8|0;return(O[K]|O[K+1]<<8)>>(H&7)&C},LO=function(O,H){var C=H/8|0;return(O[C]|O[C+1]<<8|O[C+2]<<16)>>(H&7)},SO=function(O){return(O+7)/8|0},mO=function(O,H,C){if(H==null||H<0)H=0;if(C==null||C>O.length)C=O.length;return new T(O.subarray(H,C))};var JH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],i=function(O,H,C){var K=Error(H||JH[O]);if(K.code=O,Error.captureStackTrace)Error.captureStackTrace(K,i);if(!C)throw K;return K},UH=function(O,H,C,K){var E=O.length,R=K?K.length:0;if(!E||H.f&&!H.l)return C||new T(0);var Y=!C,X=Y||H.i!=2,Q=H.i;if(Y)C=new T(E*3);var $=function(KO){var RO=C.length;if(KO>RO){var HO=new T(Math.max(RO*2,KO));HO.set(C),C=HO}},N=H.f||0,V=H.p||0,J=H.b||0,F=H.l,A=H.d,W=H.m,w=H.n,n=E*8;do{if(!F){N=b(O,V,1);var _=b(O,V+1,3);if(V+=3,!_){var I=SO(V)+4,g=O[I-4]|O[I-3]<<8,D=I+g;if(D>E){if(Q)i(0);break}if(X)$(J+g);C.set(O.subarray(I,D),J),H.b=J+=g,H.p=V=D*8,H.f=N;continue}else if(_==1)F=YH,A=XH,W=9,w=5;else if(_==2){var y=b(O,V,31)+257,G=b(O,V+10,15)+4,M=y+b(O,V+5,31)+1;V+=14;var U=new T(M),j=new T(19);for(var B=0;B<G;++B)j[IO[B]]=b(O,V+B*3,7);V+=G*3;var x=qO(j),a=(1<<x)-1,h=c(j,x,1);for(var B=0;B<M;){var v=h[b(O,V,a)];V+=v&15;var I=v>>4;if(I<16)U[B++]=I;else{var Z=0,q=0;if(I==16)q=3+b(O,V,3),V+=2,Z=U[B-1];else if(I==17)q=3+b(O,V,7),V+=3;else if(I==18)q=11+b(O,V,127),V+=7;while(q--)U[B++]=Z}}var z=U.subarray(0,y),S=U.subarray(y);W=qO(z),w=qO(S),F=c(z,W,1),A=c(S,w,1)}else i(1);if(V>n){if(Q)i(0);break}}if(X)$(J+131072);var CO=(1<<W)-1,r=(1<<w)-1,l=V;for(;;l=V){var Z=F[LO(O,V)&CO],u=Z>>4;if(V+=Z&15,V>n){if(Q)i(0);break}if(!Z)i(2);if(u<256)C[J++]=u;else if(u==256){l=V,F=null;break}else{var m=u-254;if(u>264){var B=u-257,L=$O[B];m=b(O,V,(1<<L)-1)+hO[B],V+=L}var o=A[LO(O,V)&r],t=o>>4;if(!o)i(3);V+=o&15;var S=EH[t];if(t>3){var L=PO[t];S+=LO(O,V)&(1<<L)-1,V+=L}if(V>n){if(Q)i(0);break}if(X)$(J+131072);var OO=J+m;if(J<S){var XO=R-S,JO=Math.min(S,OO);if(XO+J<0)i(3);for(;J<JO;++J)C[J]=K[XO+J]}for(;J<OO;++J)C[J]=C[J-S]}}if(H.l=F,H.p=l,H.b=J,H.f=N,F)N=1,H.m=W,H.d=A,H.n=w}while(!N);return J!=C.length&&Y?mO(C,0,J):C.subarray(0,J)},d=function(O,H,C){C<<=H&7;var K=H/8|0;O[K]|=C,O[K+1]|=C>>8},EO=function(O,H,C){C<<=H&7;var K=H/8|0;O[K]|=C,O[K+1]|=C>>8,O[K+2]|=C>>16},BO=function(O,H){var C=[];for(var K=0;K<O.length;++K)if(O[K])C.push({s:K,f:O[K]});var E=C.length,R=C.slice();if(!E)return{t:rO,l:0};if(E==1){var Y=new T(C[0].s+1);return Y[C[0].s]=1,{t:Y,l:1}}C.sort(function(D,y){return D.f-y.f}),C.push({s:-1,f:25001});var X=C[0],Q=C[1],$=0,N=1,V=2;C[0]={s:-1,f:X.f+Q.f,l:X,r:Q};while(N!=E-1)X=C[C[$].f<C[V].f?$++:V++],Q=C[$!=N&&C[$].f<C[V].f?$++:V++],C[N++]={s:-1,f:X.f+Q.f,l:X,r:Q};var J=R[0].s;for(var K=1;K<E;++K)if(R[K].s>J)J=R[K].s;var F=new p(J+1),A=jO(C[N-1],F,0);if(A>H){var K=0,W=0,w=A-H,n=1<<w;R.sort(function(y,G){return F[G.s]-F[y.s]||y.f-G.f});for(;K<E;++K){var _=R[K].s;if(F[_]>H)W+=n-(1<<A-F[_]),F[_]=H;else break}W>>=w;while(W>0){var I=R[K].s;if(F[I]<H)W-=1<<H-F[I]++-1;else++K}for(;K>=0&&W;--K){var g=R[K].s;if(F[g]==H)--F[g],++W}A=H}return{t:new T(F),l:A}},jO=function(O,H,C){return O.s==-1?Math.max(jO(O.l,H,C+1),jO(O.r,H,C+1)):H[O.s]=C},vO=function(O){var H=O.length;while(H&&!O[--H]);var C=new p(++H),K=0,E=O[0],R=1,Y=function(Q){C[K++]=Q};for(var X=1;X<=H;++X)if(O[X]==E&&X!=H)++R;else{if(!E&&R>2){for(;R>138;R-=138)Y(32754);if(R>2)Y(R>10?R-11<<5|28690:R-3<<5|12305),R=0}else if(R>3){Y(E),--R;for(;R>6;R-=6)Y(8304);if(R>2)Y(R-3<<5|8208),R=0}while(R--)Y(E);R=1,E=O[X]}return{c:C.subarray(0,K),n:H}},NO=function(O,H){var C=0;for(var K=0;K<H.length;++K)C+=O[K]*H[K];return C},pO=function(O,H,C){var K=C.length,E=SO(H+2);O[E]=K&255,O[E+1]=K>>8,O[E+2]=O[E]^255,O[E+3]=O[E+1]^255;for(var R=0;R<K;++R)O[E+R+4]=C[R];return(E+4+K)*8},zO=function(O,H,C,K,E,R,Y,X,Q,$,N){d(H,N++,C),++E[256];var V=BO(E,15),J=V.t,F=V.l,A=BO(R,15),W=A.t,w=A.l,n=vO(J),_=n.c,I=n.n,g=vO(W),D=g.c,y=g.n,G=new p(19);for(var M=0;M<_.length;++M)++G[_[M]&31];for(var M=0;M<D.length;++M)++G[D[M]&31];var U=BO(G,7),j=U.t,B=U.l,x=19;for(;x>4&&!j[IO[x-1]];--x);var a=$+5<<3,h=NO(E,e)+NO(R,YO)+Y,v=NO(E,J)+NO(R,W)+Y+14+3*x+NO(G,j)+2*G[16]+3*G[17]+7*G[18];if(Q>=0&&a<=h&&a<=v)return pO(H,N,O.subarray(Q,Q+$));var Z,q,z,S;if(d(H,N,1+(v<h)),N+=2,v<h){Z=c(J,F,0),q=J,z=c(W,w,0),S=W;var CO=c(j,B,0);d(H,N,I-257),d(H,N+5,y-1),d(H,N+10,x-4),N+=14;for(var M=0;M<x;++M)d(H,N+3*M,j[IO[M]]);N+=3*x;var r=[_,D];for(var l=0;l<2;++l){var u=r[l];for(var M=0;M<u.length;++M){var m=u[M]&31;if(d(H,N,CO[m]),N+=j[m],m>15)d(H,N,u[M]>>5&127),N+=u[M]>>12}}}else Z=NH,q=e,z=VH,S=YO;for(var M=0;M<X;++M){var L=K[M];if(L>255){var m=L>>18&31;if(EO(H,N,Z[m+257]),N+=q[m+257],m>7)d(H,N,L>>23&31),N+=$O[m];var o=L&31;if(EO(H,N,z[o]),N+=S[o],o>3)EO(H,N,L>>5&8191),N+=PO[o]}else EO(H,N,Z[L]),N+=q[L]}return EO(H,N,Z[256]),N+q[256]},$H=new ZO([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rO=new T(0),PH=function(O,H,C,K,E,R){var Y=R.z||O.length,X=new T(K+Y+5*(1+Math.ceil(Y/7000))+E),Q=X.subarray(K,X.length-E),$=R.l,N=(R.r||0)&7;if(H){if(N)Q[0]=R.r>>3;var V=$H[H-1],J=V>>13,F=V&8191,A=(1<<C)-1,W=R.p||new p(32768),w=R.h||new p(A+1),n=Math.ceil(C/3),_=2*n,I=function(WO){return(O[WO]^O[WO+1]<<n^O[WO+2]<<_)&A},g=new ZO(25000),D=new p(288),y=new p(32),G=0,M=0,U=R.i||0,j=0,B=R.w||0,x=0;for(;U+2<Y;++U){var a=I(U),h=U&32767,v=w[a];if(W[h]=v,w[a]=h,B<=U){var Z=Y-U;if((G>7000||j>24576)&&(Z>423||!$)){N=zO(O,Q,0,g,D,y,M,j,x,U-x,N),j=G=M=0,x=U;for(var q=0;q<286;++q)D[q]=0;for(var q=0;q<30;++q)y[q]=0}var z=2,S=0,CO=F,r=h-v&32767;if(Z>2&&a==I(U-r)){var l=Math.min(J,Z)-1,u=Math.min(32767,U),m=Math.min(258,Z);while(r<=u&&--CO&&h!=v){if(O[U+z]==O[U+z-r]){var L=0;for(;L<m&&O[U+L]==O[U+L-r];++L);if(L>z){if(z=L,S=r,L>l)break;var o=Math.min(r,L-2),t=0;for(var q=0;q<o;++q){var OO=U-r+q&32767,XO=W[OO],JO=OO-XO&32767;if(JO>t)t=JO,v=OO}}}h=v,v=W[h],r+=h-v&32767}}if(S){g[j++]=268435456|AO[z]<<18|wO[S];var KO=AO[z]&31,RO=wO[S]&31;M+=$O[KO]+PO[RO],++D[257+KO],++y[RO],B=U+z,++G}else g[j++]=O[U],++D[O[U]]}}for(U=Math.max(U,B);U<Y;++U)g[j++]=O[U],++D[O[U]];if(N=zO(O,Q,$,g,D,y,M,j,x,U-x,N),!$)R.r=N&7|Q[N/8|0]<<3,N-=7,R.h=w,R.p=W,R.i=U,R.w=B}else{for(var U=R.w||0;U<Y+$;U+=65535){var HO=U+65535;if(HO>=Y)Q[N/8|0]=$,HO=Y;N=pO(Q,N+1,O.subarray(U,HO))}R.i=Y}return mO(X,0,K+SO(N)+E)};var QH=function(O,H,C,K,E){if(!E){if(E={l:1},H.dictionary){var R=H.dictionary.subarray(-32768),Y=new T(R.length+O.length);Y.set(R),Y.set(O,R.length),O=Y,E.w=R.length}}return PH(O,H.level==null?6:H.level,H.mem==null?E.l?Math.ceil(Math.max(8,Math.min(13,Math.log(O.length)))*1.5):20:12+H.mem,C,K,E)};function nO(O,H){return QH(O,H||{},0,0)}function bO(O,H){return UH(O,{i:2},H&&H.out,H&&H.dictionary)}var MH=typeof TextDecoder<"u"&&new TextDecoder,FH=0;try{MH.decode(rO,{stream:!0}),FH=1}catch(O){}var DO;((R)=>{R.UploadStart="UPLOAD_START";R.ChunkConsumed="CHUNK_CONSUMED";R.Pause="UPLOAD_PAUSE";R.Resume="UPLOAD_RESUME";R.Cancel="UPLOAD_CANCEL"})(DO||={});var xO;((C)=>{C.DownloadStart="DOWNLOAD_START";C.Abort="DOWNLOAD_ABORT"})(xO||={});var sO=globalThis,AH=sO.__USE_MOCK_STORE__===!0||typeof process<"u"&&process.env?.USE_MOCK_STORE==="true",GH=sO.__DEBUG_CHUNK_SIZES__===!0||typeof process<"u"&&process.env?.DEBUG_CHUNK_SIZES==="true",k=(...O)=>{if(!GH)return;console.log("[StoreWorker]",...O)},{createStoreService:tO}=AH?await Promise.resolve().then(() => (fO(),oO)):await Promise.resolve().then(() => (aO(),iO)),eO=524288;var s=new Map,VO=new Map;self.onmessage=(O)=>{let H=O.data;if(jH(H))SH(H);else if(ZH(H))pH(H);else console.warn("[StoreWorker] Unknown message",H)};function jH(O){return Object.values(DO).includes(O.type)}function ZH(O){return Object.values(xO).includes(O.type)}function SH(O){switch(O.type){case"UPLOAD_START":TH(O);break;case"UPLOAD_CANCEL":HH(O.fileId);break;case"UPLOAD_PAUSE":hH(O.fileId);break;case"UPLOAD_RESUME":uH(O.fileId);break;case"CHUNK_CONSUMED":break;default:console.warn("[UploadWorker] Unknown message",O)}}var DH=5,xH={attempts:3,delayMs:1000};async function TH(O){let{fileId:H,file:C}=O;if(s.has(H))HH(H);let K=C.stream().getReader(),E=tO(O.store),R={fileId:H,file:C,reader:K,store:E,buffer:new Uint8Array(0),bytesProcessed:0,totalBytes:C.size,nextChunkNumber:0,pendingUploads:new Map,retry:O.retry??xH,maxBufferedChunks:O.maxBufferedChunks??DH,paused:!1,cancelled:!1,streamEnded:!1};s.set(H,R);try{await gH(R)}catch(Y){FO(R,Y)}}async function gH(O){while(!O.cancelled){if(O.paused){await CH(100);continue}let{value:H,done:C}=await O.reader.read();if(H)O.bytesProcessed+=H.length,O.buffer=mH(O.buffer,H),kH(O),MO(O,!1);if(C){O.streamEnded=!0,MO(O,!0),await vH(O),_H(O);break}}}function MO(O,H){while(O.buffer.length>0&&O.pendingUploads.size<O.maxBufferedChunks){let C=yH(O.buffer.length,H);if(C===0)break;let K=O.buffer.slice(0,C);O.buffer=O.buffer.slice(C);let E=nO(K,{level:3}),R=O.nextChunkNumber++;k("chunk created",{chunkNumber:R,originalSize:K.length,compressedSize:E.length,ratio:(E.length/K.length*100).toFixed(1)+"%"}),wH(O,R,E,K.length)}}function yH(O,H){if(O<=0)return 0;if(O>=eO)return eO;if(H)return O;return 0}function wH(O,H,C,K){if(C.length===0){let Y=Error(`[Worker] Compressed chunk is empty: fileId=${O.fileId}, chunkNumber=${H}, originalSize=${K}`);console.error(Y),FO(O,Y,H);return}let E=Array.from(O.pendingUploads.values()).map((Y)=>Y.promise),R=Promise.all(E).then(()=>OH(O,H,C,K,1));O.pendingUploads.set(H,{chunkNumber:H,promise:R}),R.then((Y)=>zH(O,H,C.length,K,Y)).catch((Y)=>FO(O,Y,H)).finally(()=>{O.pendingUploads.delete(H),MO(O,O.streamEnded)})}async function OH(O,H,C,K,E){try{return await O.store.save(C,K,"deflate")}catch(R){if(E>=O.retry.attempts)throw R;return await CH(O.retry.delayMs*E),OH(O,H,C,K,E+1)}}async function vH(O){while(O.pendingUploads.size>0||O.buffer.length>0){let H=Array.from(O.pendingUploads.values()).map((C)=>C.promise);if(H.length===0){MO(O,O.streamEnded);continue}await Promise.all(H)}}function zH(O,H,C,K,E){if(C===0){let Y=Error(`[Worker] Attempted to save empty chunk: fileId=${O.fileId}, chunkNumber=${H}`);console.error(Y),FO(O,Y,H);return}k("chunk saved",{fileId:O.fileId,chunkNumber:H,chunkSize:C,originalSize:K,hash:E});let R={type:"CHUNK_READY",fileId:O.fileId,chunkNumber:H,chunkSize:C,hash:E};self.postMessage(R)}function kH(O){let H={type:"UPLOAD_PROGRESS",fileId:O.fileId,bytesProcessed:O.bytesProcessed,totalBytes:O.totalBytes};self.postMessage(H)}function _H(O){let H={type:"FILE_UPLOADED",fileId:O.fileId,totalChunks:O.nextChunkNumber};self.postMessage(H),s.delete(O.fileId)}function FO(O,H,C){let K={type:"UPLOAD_ERROR",fileId:O.fileId,chunkNumber:C,error:H instanceof Error?H.message:String(H)};self.postMessage(K)}function HH(O){let H=s.get(O);if(!H)return;H.cancelled=!0,H.reader.cancel().catch(()=>{return}),s.delete(O)}function hH(O){let H=s.get(O);if(H)H.paused=!0}function uH(O){let H=s.get(O);if(H)H.paused=!1}function mH(O,H){if(O.length===0)return H;if(H.length===0)return O;let C=new Uint8Array(O.length+H.length);return C.set(O),C.set(H,O.length),C}function CH(O){return new Promise((H)=>setTimeout(H,O))}function pH(O){switch(O.type){case"DOWNLOAD_START":rH(O);break;case"DOWNLOAD_ABORT":KH(O.fileId);break;default:console.warn("[DownloadWorker] Unknown message",O)}}async function rH(O){let{fileId:H,chunks:C}=O;if(VO.has(H))KH(H);k("download start",{fileId:H,totalChunks:C.length});let K=tO(O.store),E=cH(O.destination),R={fileId:H,store:K,writer:E,aborted:!1};VO.set(H,R);let Y=fH(E);try{for(let X=0;X<C.length;X++){if(R.aborted)break;let Q=C[X];k("download chunk fetch:start",{fileId:H,chunkNumber:X,hash:Q});let $=await K.get(Q);k("download chunk fetch:done",{fileId:H,chunkNumber:X,compressedBytes:$.byteLength});let N=bO($);k("download chunk decompressed",{fileId:H,chunkNumber:X,compressedBytes:$.byteLength,decompressedBytes:N.byteLength}),Y(N),nH(R,X)}if(!R.aborted)await Y(),await E.close(),k("download complete",{fileId:H}),bH(R)}catch(X){k("download error",{fileId:H,error:X}),oH(R,X)}finally{VO.delete(H)}}function KH(O){let H=VO.get(O);if(!H)return;H.aborted=!0,H.writer.abort().catch(()=>{return}),VO.delete(O)}function nH(O,H){k("download chunk processed",{fileId:O.fileId,chunkNumber:H});let C={type:"DOWNLOAD_CHUNK",fileId:O.fileId,chunkNumber:H};self.postMessage(C)}function bH(O){k("download file downloaded",{fileId:O.fileId});let H={type:"FILE_DOWNLOADED",fileId:O.fileId};self.postMessage(H)}function oH(O,H){k("download emit error",{fileId:O.fileId,error:H});let C={type:"DOWNLOAD_ERROR",fileId:O.fileId,error:H instanceof Error?H.message:String(H)};self.postMessage(C)}function fH(O){let H=Promise.resolve();return(C)=>{if(!C)return H;return H=H.then(()=>O.write(C)),H}}function cH(O){if(lH(O))return O.getWriter();return dH(O)}function lH(O){return typeof O.getWriter==="function"}function dH(O){let H=!1;return{write(C){if(H)return Promise.reject(Error("Cannot write to a closed port destination"));let K=C.buffer.slice(C.byteOffset,C.byteOffset+C.byteLength);return k("port writer write",{bytes:K.byteLength}),O.postMessage(K,[K]),Promise.resolve()},close(){if(H)return Promise.resolve();return H=!0,k("port writer close"),O.postMessage({type:"close"}),O.close(),Promise.resolve()},abort(C){if(H)return Promise.resolve();return H=!0,k("port writer abort",{reason:C}),O.postMessage({type:"abort",error:C instanceof Error?C.message:C?String(C):void 0}),O.close(),Promise.resolve()}}}
